# 傘判断アプリ 仕様書

## 概要
外出時に傘を持っていくべきかどうかを判断してくれるスマートフォンアプリ

## 技術スタック
- **フレームワーク**: Expo (React Native)
- **天気API**: 気象庁API（非公式・無料）
- **対象プラットフォーム**: iOS / Android

---

## 機能一覧

### 1. メイン画面（傘判断表示）
- **シンプル表示（デフォルト）**
  - 「☂️ 傘を持っていこう」
  - 「☀️ 傘は不要」
  - アイコン + 一言メッセージのみで視覚的に分かりやすく

- **詳細表示（タップで展開）**
  - 降水確率（時間帯別）
  - 予想降水量
  - 天気の変化予報

### 2. 位置情報機能（出発地・目的地対応）
- **出発地設定**
  - GPS自動取得（デフォルト）
  - または登録済み地点から選択

- **目的地設定**
  - 会社や学校など目的地を登録
  - 出発地と目的地の両方の天気を考慮して判断

- **総合判断**
  - どちらかの地点で雨が降る可能性があれば傘が必要と判断
  - どの地点で傘が必要かを明示

### 3. 外出時間指定機能
- 外出予定時間を設定（例: 9:00〜18:00）
- 指定した時間帯の天気予報から傘の要否を判断
- デフォルト時間を設定可能

### 4. プッシュ通知機能
- 毎朝指定時刻に傘の要否を通知
- 通知時刻は設定可能（例: 7:00）
- 通知ON/OFF切り替え可能

---

## 画面構成

### ホーム画面
```
┌─────────────────────────┐
│  📍 東京都渋谷区        │
│                         │
│    ☂️                   │
│  傘を持っていこう       │
│                         │
│  [タップで詳細を見る]   │
├─────────────────────────┤
│  外出予定: 9:00-18:00   │
│  降水確率: 60%          │
└─────────────────────────┘
```

### 詳細画面（展開時）
```
┌─────────────────────────┐
│  時間帯別予報           │
│  ─────────────────────  │
│  09:00  ☁️  10%         │
│  12:00  🌧️  60%         │
│  15:00  🌧️  70%         │
│  18:00  ☁️  30%         │
└─────────────────────────┘
```

### 設定画面
- 位置情報設定（GPS / 手動）
- 登録地点の管理
- 外出時間のデフォルト設定
- 通知設定（時刻・ON/OFF）

---

## 傘判断ロジック

```
傘が必要な条件:
- 外出時間帯のいずれかで降水確率が 50% 以上
- または予想降水量が 1mm 以上

傘不要の条件:
- 外出時間帯すべてで降水確率が 30% 未満
- かつ予想降水量が 0mm

微妙な場合:
- 「念のため折りたたみ傘を」などのメッセージ
```

---

## 気象庁API について

- **エンドポイント**: `https://www.jma.go.jp/bosai/forecast/data/forecast/{area_code}.json`
- **特徴**:
  - 完全無料（APIキー不要）
  - 日本国内のみ対応
  - 非公式API（仕様変更の可能性あり）
- **注意点**:
  - 地域コードの取得が必要
  - 時間帯別の詳細予報は解析が必要

---

## 開発フェーズ

### Phase 1: 基本構造
- [x] Expoプロジェクトの作成
- [x] 基本的な画面構成（ナビゲーション）
- [x] UIコンポーネントの作成

### Phase 2: 天気データ取得
- [x] 気象庁APIの実装
- [x] 地域コード管理
- [x] データのキャッシュ

### Phase 3: 位置情報
- [x] GPS取得機能
- [x] 手動地域設定
- [x] 地点の保存（AsyncStorage）

### Phase 4: 傘判断ロジック
- [x] 時間帯フィルタリング
- [x] 判断アルゴリズムの実装
- [x] メッセージ生成

### Phase 5: 通知機能
- [x] プッシュ通知のセットアップ
- [x] バックグラウンドタスク
- [x] 通知スケジュール管理

### Phase 6: 設定・仕上げ
- [x] 設定画面の実装
- [x] デザイン調整
- [ ] テスト・バグ修正

### Phase 7: 出発地・目的地機能
- [x] 型定義の拡張（出発地・目的地）
- [x] 総合判断ロジックの実装
- [x] ホーム画面の更新（両地点表示）
- [x] 設定画面の更新（出発地・目的地選択）
